version: '3.8'

services:
  logitrack:
    image: logitrack:latest
    # Swarm não suporta 'build' direto na stack sem registry. Vamos usar a imagem construída manualmente.
    # build:
    #   context: .
    #   args: ...

    # Swarm usa 'deploy' para reiniciar
    deploy:
      replicas: 1
      restart_policy:
        condition: on-failure
      placement:
        constraints:
          # Garante que rode no manager (necessário se usar imagem local sem registry)
          - node.role == manager

    # container_name: logitrack-app # Não suportado no Swarm

    environment:
      - VITE_SUPABASE_URL=${VITE_SUPABASE_URL}
      - VITE_SUPABASE_ANON_KEY=${VITE_SUPABASE_ANON_KEY}
    ports:
      - "3000:80"
    networks:
      - alc_public

networks:
  alc_public:
    external: true